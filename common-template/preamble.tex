%% ==========================================================================
%% preamble.tex - Core LaTeX packages for academic papers
%% ==========================================================================
%% Include with: \input{preamble.tex}
%% For TikZ figures, also include: \input{tikz/setup.tex}
%% ==========================================================================

%%% Core math and graphics
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{amsthm}             % theorem environments (proof, etc.)
\usepackage{mathtools}          % extends amsmath
\usepackage{mathrsfs}           % \mathscr for script fonts
\usepackage{bm}                 % bold math symbols
\usepackage{graphicx}
\usepackage{xcolor}             % color support

%%% Typography
\usepackage{microtype}          % better typography (kerning, spacing)
\usepackage[english]{babel}     % hyphenation patterns
\usepackage{setspace}           % line spacing (\onehalfspacing, \doublespacing)

%%% Tables
\usepackage{booktabs}           % professional tables (\toprule, \midrule, \bottomrule)
\usepackage{multirow}           % multi-row cells in tables
\usepackage{array}              % extended column definitions

%%% Figures
\usepackage{caption}
\captionsetup{
  justification=raggedright,
  singlelinecheck=false
}
\usepackage{subcaption}         % subfigures (\begin{subfigure})

%%% Algorithms (comment out if not needed)
\usepackage[ruled,vlined]{algorithm2e}

%%% Document structure
\usepackage{subfiles}           % multi-file documents
\usepackage[toc,page,title,titletoc]{appendix}

%%% Authors
\usepackage{authblk}            % multiple authors with affiliations

%%% Hyperlinks (load near end - redefines many commands)
\PassOptionsToPackage{hyphens}{url}  % allow URL line breaks at hyphens
\definecolor{linkblue}{rgb}{0.0, 0.0, 0.55}
\definecolor{citeblue}{rgb}{0.0, 0.0, 0.55}
\definecolor{urlblue}{rgb}{0.0, 0.25, 0.55}
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=linkblue,
  citecolor=citeblue,
  urlcolor=urlblue,
  plainpages=false,
  hypertexnames=false
}
\usepackage{bookmark}           % better PDF bookmarks (must follow hyperref)

%%% Bibliography
\usepackage{natbib}

%% ==========================================================================
%% Theorem environments
%% ==========================================================================
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

%% ==========================================================================
%% Numbering
%% ==========================================================================
\numberwithin{equation}{section}
\numberwithin{table}{section}
\numberwithin{figure}{section}

%% ==========================================================================
%% Common math macros
%% ==========================================================================

%%% Number sets
\newcommand{\R}{\mathbb{R}}     % real numbers
\newcommand{\Z}{\mathbb{Z}}     % integers
\newcommand{\N}{\mathbb{N}}     % natural numbers
\newcommand{\Q}{\mathbb{Q}}     % rationals
\newcommand{\C}{\mathbb{C}}     % complex numbers

%%% Probability and expectation
\newcommand{\E}{\mathbb{E}}     % expectation
\newcommand{\Var}{\mathrm{Var}} % variance
\newcommand{\Cov}{\mathrm{Cov}} % covariance
\newcommand{\pr}{\mathbb{P}}    % probability
\newcommand{\ind}[1]{\mathbf{1}_{\{#1\}}} % indicator function

%%% Common operators
\newcommand{\argmin}{\operatornamewithlimits{argmin}}
\newcommand{\argmax}{\operatornamewithlimits{argmax}}

%%% Brackets and norms
\newcommand{\abs}[1]{\left|#1\right|}           % absolute value
\newcommand{\norm}[1]{\left\|#1\right\|}        % norm
\newcommand{\inner}[2]{\langle#1,#2\rangle}     % inner product
\newcommand{\floor}[1]{\lfloor#1\rfloor}        % floor
\newcommand{\ceil}[1]{\lceil#1\rceil}           % ceiling
\newcommand{\pos}[1]{\left[#1\right]^+}         % positive part

%%% Convergence
\newcommand{\dto}{\Rightarrow}                  % convergence in distribution
\newcommand{\pto}{\xrightarrow{p}}              % convergence in probability
\newcommand{\asto}{\xrightarrow{a.s.}}          % almost sure convergence
